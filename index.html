<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estimador IA - Debug Mode</title>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; padding: 20px; }
        .box { max-width: 500px; margin: auto; background: #1e293b; padding: 20px; border-radius: 10px; border: 1px solid #334155; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; }
        button { width: 100%; padding: 15px; background: #6366f1; color: white; border: none; cursor: pointer; border-radius: 5px; font-weight: bold; }
        #debug { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; font-family: monospace; font-size: 12px; }
        .err { background: #7f1d1d; color: #fecaca; border: 1px solid #ef4444; }
        .ok { background: #064e3b; color: #dcfce7; border: 1px solid #10b981; }
    </style>
</head>
<body>

<div class="box">
    <h3>üîç Diagn√≥stico T√©cnico</h3>
    <input type="password" id="key" placeholder="Pega tu API Key (AIza...)">
    <textarea id="story" placeholder="Escribe cualquier cosa para probar..."></textarea>
    <button onclick="testConexion()">EJECUTAR PRUEBA</button>
    <div id="debug"></div>
</div>

<script>
async function testConexion() {
    const key = document.getElementById('key').value.trim();
    const story = document.getElementById('story').value.trim();
    const debug = document.getElementById('debug');
    
    debug.style.display = "block";
    debug.className = "ok";
    debug.innerText = "‚è≥ Conectando con Google...";

    // Probaremos el endpoint m√°s b√°sico y estable
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: "Hola, responde solo la palabra 'OK'" }] }]
            })
        });

        const data = await response.json();

        if (!response.ok) {
            debug.className = "err";
            debug.innerText = `‚ùå ERROR DE GOOGLE:\nStatus: ${response.status}\nMotivo: ${data.error ? data.error.message : 'Desconocido'}\nStatus Info: ${data.error ? data.error.status : ''}`;
            return;
        }

        debug.className = "ok";
        debug.innerText = "‚úÖ ¬°CONEXI√ìN EXITOSA!\nGoogle respondi√≥ correctamente. Ahora puedes usar el estimador completo.";

    } catch (e) {
        debug.className = "err";
        debug.innerText = "‚ùå ERROR DE RED:\nNo se pudo contactar al servidor. Posibles causas:\n1. Est√°s en un pa√≠s restringido.\n2. Tu navegador bloquea la petici√≥n.\n3. La API Key est√° mal copiada.";
    }
}
</script>
</body>
</html>
