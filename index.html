<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimador Avanzado de Historias de Usuario</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f2fe;
        }
        .dark body {
            background-color: #1a202c;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            transition: all 0.3s ease-in-out;
        }
        .dark .card {
            background-color: #2d3748;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
        }
        .header-title { color: #1e40af; }
        .dark .header-title { color: #90cdf4; }
        .section-title { color: #10b981; }
        .dark .section-title { color: #6ee7b7; }
        .input-field {
            border-color: #a7f3d0;
            background-color: #ecfdf5;
            color: #065f46;
        }
        .dark .input-field {
            border-color: #4ade80;
            background-color: #14532d;
            color: #d1fae5;
        }
        .input-field:focus {
            border-color: #34d399;
            box-shadow: 0 0 0 2px rgba(52, 211, 153, 0.5);
        }
        .dark .input-field:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.5);
        }
        .result-box {
            background-color: #dbeafe;
            border-color: #93c5fd;
            color: #1e40af;
        }
        .dark .result-box {
            background-color: #1e3a8a;
            border-color: #3b82f6;
            color: #bfdbfe;
        }
        .scenario-optimistic {
            background-color: #d1fae5;
            border-color: #6ee7b7;
            color: #065f46;
        }
        .dark .scenario-optimistic {
            background-color: #064e3b;
            border-color: #34d399;
            color: #a7f3d0;
        }
        .scenario-most-probable {
            background-color: #fffbeb;
            border-color: #fcd34d;
            color: #92400e;
        }
        .dark .scenario-most-probable {
            background-color: #451a03;
            border-color: #fbbf24;
            color: #fde68a;
        }
        .scenario-pessimistic {
            background-color: #fee2e2;
            border-color: #fca5a5;
            color: #991b1b;
        }
        .dark .scenario-pessimistic {
            background-color: #7f1d1d;
            border-color: #ef4444;
            color: #fecaca;
        }
        .footer-text { color: #6b7280; }
        .dark .footer-text { color: #9ca3af; }

        .toggle-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2196F3; }
        input:focus + .slider { box-shadow: 0 0 1px #2196F3; }
        input:checked + .slider:before { transform: translateX(26px); }

        /* --- Estilos para la Impresi贸n en PDF --- */
        @media print {
            .no-print, .toggle-switch {
                display: none !important;
            }
            body, .card {
                background-color: #ffffff !important;
                color: #000000 !important;
                box-shadow: none !important;
                border: none !important;
                padding: 0;
            }
            .header-title, .section-title, .text-blue-600, .dark .text-blue-400 {
                color: #000000 !important;
            }
            .space-y-8 > div {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="estimatorForm" class="card w-full max-w-2xl">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-4xl font-extrabold text-center header-title">
                Estimador Avanzado
            </h1>
            <div class="flex items-center space-x-2 no-print">
                <span class="text-sm footer-text"></span>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        <p class="text-center text-base footer-text mb-10">
            Estima el peso de una historia de usuario aplicando multiplicadores de contexto al esfuerzo base.
        </p>

        <div class="space-y-8 mb-10">
            <h2 class="text-2xl font-bold section-title">Factores de Estimaci贸n Base</h2>
            
            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 space-y-4 border border-gray-200 dark:border-gray-600">
                <div class="flex items-center justify-between">
                    <label for="logicComplexity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Complejidad de L贸gica y Algoritmos (Back-End)
                    </label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="logicComplexityToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <select id="logicComplexity" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="4">XS (4 horas)</option> 
                    <option value="8">S (8 horas)</option>
                    <option value="16">M (16 horas)</option>
                    <option value="24" selected>L (24 horas)</option>
                    <option value="32">XL (32 horas)</option>
                    <option value="40">XXL (40 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Calcula el esfuerzo de la funcionalidad central del back-end.</p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 space-y-4 border border-gray-200 dark:border-gray-600">
                <div class="flex items-center justify-between">
                    <label for="frontendLogicComplexity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Complejidad L贸gica Front-End
                    </label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="frontendLogicComplexityToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <select id="frontendLogicComplexity" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="4">XS (4 horas)</option> 
                    <option value="8">S (8 horas)</option>
                    <option value="16">M (16 horas)</option>
                    <option value="24" selected>L (24 horas)</option>
                    <option value="32">XL (32 horas)</option>
                    <option value="40">XXL (40 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Calcula la dificultad de la l贸gica y los algoritmos del front-end.</p>
            </div>
            
            <div class="space-y-4">
                <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100">Pruebas Unitarias</h3>
                <div>
                    <label for="unitTestBackHours" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Back-End (15% de L贸gica Back-End)
                    </label>
                    <div id="unitTestBackHours" class="input-field w-full px-4 py-2 border rounded-xl" readonly>0 horas</div>
                </div>
                <div>
                    <label for="unitTestFrontHours" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Front-End (15% de L贸gica Front-End)
                    </label>
                    <div id="unitTestFrontHours" class="input-field w-full px-4 py-2 border rounded-xl" readonly>0 horas</div>
                </div>
                <div class="mt-2 text-base font-bold text-gray-800 dark:text-gray-100">
                    Total Pruebas Unitarias: <span id="unitTestTotal" class="text-blue-600 dark:text-blue-400">0 horas</span>
                </div>
            </div>

            <div>
                <label for="staticAnalysisHours" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Revisi贸n de C贸digo Est谩tico, An谩lisis y Soluci贸n (10% de L贸gica Back-End + Front-End)
                </label>
                <div id="staticAnalysisHours" class="input-field w-full px-4 py-2 border rounded-xl" readonly>0 horas</div>
                <p class="mt-1 text-xs footer-text">
                    Tiempo para an谩lisis est谩tico del c贸digo y correcci贸n de advertencias y errores.
                </p>
            </div>

            <div>
                <label for="peerReviewHours" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Revisi贸n Par (7% de L贸gica Back-End + Front-End)
                </label>
                <div id="peerReviewHours" class="input-field w-full px-4 py-2 border rounded-xl" readonly>0 horas</div>
                <p class="mt-1 text-xs footer-text">
                    Tiempo para la revisi贸n y retroalimentaci贸n del c贸digo por parte de un compa帽ero.
                </p>
            </div>
            
            <div>
                <label for="uiComplexity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Complejidad de la Interfaz (UI/UX)
                </label>
                <select id="uiComplexity" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="0">Ninguna (0 horas)</option>
                    <option value="2">Baja (2 horas)</option>
                    <option value="4" selected>Media (4 horas)</option>
                    <option value="8">Alta (8 horas)</option>
                    <option value="12">Muy Alta (12 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Estima el tiempo de dise帽o y desarrollo de la interfaz.</p>
            </div>
            
            <div>
                <label for="integrationComplexity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Complejidad de la Integraci贸n
                </label>
                <select id="integrationComplexity" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="0" selected>Ninguna (0 hora)</option>
                    <option value="2">Baja (2 horas)</option>
                    <option value="4">Media (4 horas)</option>
                    <option value="8">Alta (8 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Eval煤a la dificultad de conectar con otros sistemas o APIs.</p>
            </div>
            
            <div>
                <label for="dataComplexity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Complejidad de Datos
                </label>
                <select id="dataComplexity" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="0" selected>Ninguna (0 horas)</option>
                    <option value="2">Baja (2 horas)</option>
                    <option value="4">Media (4 horas)</option>
                    <option value="8">Alta (8 horas)</option>
                    <option value="12">Muy Alta (12 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Considera el manejo de bases de datos, migraciones o vol煤menes de datos.</p>
            </div>
            
            <div>
                <label for="documentationComplexity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Documentaci贸n
                </label>
                <select id="documentationComplexity" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="0">Ninguna (0 horas)</option>
                    <option value="1">Baja (1 hora)</option>
                    <option value="2" selected>Media (2 horas)</option>
                    <option value="4">Alta (4 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Considera el tiempo para documentar el c贸digo y el uso.</p>
            </div>
            
            <div>
                <label for="deploymentTime" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Tiempos de Despliegue en Ambiente de QA
                </label>
                <select id="deploymentTime" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="1" selected>Baja (1 horas)</option>
                    <option value="2">Media (2 horas)</option>
                    <option value="4">Alta (4 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Impacto del tiempo de despliegue en un entorno de pruebas.</p>
            </div>
            
            <div>
                <label for="externalDependencies" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Dependencias Externas
                </label>
                <select id="externalDependencies" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="0" selected>Ninguna (0 hora)</option>
                    <option value="2">Baja (2 horas)</option>
                    <option value="4">Media (4 horas)</option>
                    <option value="8">Alta (8 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Impacto de esperar por otros equipos o APIs.</p>
            </div>
            
            <div>
                <label for="domainKnowledge" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Conocimiento del Dominio
                </label>
                <select id="domainKnowledge" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                    <option value="1">Muy Alto (1 hora)</option>
                    <option value="2">Alto (2 horas)</option>
                    <option value="4" selected>Medio (4 horas)</option>
                    <option value="8">Bajo (8 horas)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Tiempo para entender el negocio o el problema.</p>
            </div>
        </div>

        <div class="space-y-8 mb-10">
            <h2 class="text-2xl font-bold section-title">Multiplicadores de Contexto</h2>
            
            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 space-y-4 border border-gray-200 dark:border-gray-600">
                <label for="developerExperience" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Experiencia del Desarrollador</label>
                <select id="developerExperience" class="input-field w-full">
                    <option value="1.5">Junior (En aprendizaje)</option>
                    <option value="1.0" selected>Intermedio (Est谩ndar)</option>
                    <option value="0.8">Senior (Experimentado)</option>
                    <option value="0.7">Especialista / Principal (Experto en dominio)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Ajusta el tiempo seg煤n la seniority del desarrollador.</p>
            </div>

            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 space-y-4 border border-gray-200 dark:border-gray-600">
                <label for="techKnowledge" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Conocimiento de la Tecnolog铆a Principal</label>
                <select id="techKnowledge" class="input-field w-full">
                    <option value="1.4">Novedad (Tecnolog铆a nueva para el equipo)</option>
                    <option value="1.2">Principiante (Se ha usado poco, requiere consulta)</option>
                    <option value="1.0" selected>Competente (Uso regular en el equipo)</option>
                    <option value="0.9">Experto (Dominio profundo de la tecnolog铆a)</option>
                </select>
                <p class="mt-1 text-xs footer-text">Impacto de la curva de aprendizaje de la tecnolog铆a.</p>
            </div>

            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 space-y-4 border border-gray-200 dark:border-gray-600">
                 <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Variables Ambientales</h3>
                <div>
                    <label for="requirementsClarity" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Calidad de los Requisitos</label>
                    <select id="requirementsClarity" class="input-field w-full">
                        <option value="0.0" selected>Claros y Estables</option>
                        <option value="0.1">Peque帽as Ambig眉edades</option>
                        <option value="0.3">Ambiguos o Cambiantes</option>
                    </select>
                </div>
                <div>
                    <label for="pipelineMaturity" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Madurez del Pipeline (CI/CD)</label>
                    <select id="pipelineMaturity" class="input-field w-full">
                        <option value="0.0" selected>Automatizado y R谩pido</option>
                        <option value="0.05">Lento o con Pasos Manuales</option>
                        <option value="0.15">Inestable o Inexistente</option>
                    </select>
                </div>
                 <div>
                    <label for="teamCommunication" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Dependencias y Comunicaci贸n</label>
                    <select id="teamCommunication" class="input-field w-full">
                        <option value="0.0" selected>Equipo Aut贸nomo</option>
                        <option value="0.1">Dependencia de otro equipo (comunicaci贸n fluida)</option>
                        <option value="0.25">Alta dependencia o equipo bloqueador</option>
                    </select>
                </div>
            </div>

            <div class="bg-blue-50 dark:bg-blue-900/50 rounded-xl p-4 border border-blue-200 dark:border-blue-700 text-center">
                <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-200">Multiplicadores Aplicados</h3>
                <div class="flex justify-around mt-2 text-sm">
                    <span class="font-medium">Exp: <strong id="mExpDisplay" class="text-blue-600 dark:text-blue-400">1.0x</strong></span>
                    <span class="font-medium">Tec: <strong id="mTecDisplay" class="text-blue-600 dark:text-blue-400">1.0x</strong></span>
                    <span class="font-medium">Amb: <strong id="mAmbDisplay" class="text-blue-600 dark:text-blue-400">1.0x</strong></span>
                </div>
            </div>
        </div>

        <div class="space-y-8 mb-10">
            <h2 class="text-2xl font-bold section-title">Estimaci贸n de Pruebas de Calidad</h2>
            
            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 border">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-2">Pruebas QA</h3>
                    <label class="toggle-switch">
                        <input type="checkbox" id="qaCycle2Toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="flex flex-col sm:flex-row justify-between text-sm">
                    <div class="mb-2 sm:mb-0">
                        <span class="font-medium text-gray-700 dark:text-gray-300">Ciclo 1 (35% del Desarrollo):</span>
                        <span id="qaCycle1Hours" class="font-bold text-gray-900 dark:text-gray-100">0 horas</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Ciclo 2 (40% del Ciclo 1):</span>
                        <span id="qaCycle2Hours" class="font-bold text-gray-900 dark:text-gray-100">0 horas</span>
                    </div>
                </div>
                <div class="mt-4 text-lg font-bold">
                    Total: <span id="qaHoursTotal" class="text-blue-600 dark:text-blue-400">0 horas</span>
                </div>
                <p class="mt-1 text-xs footer-text">Incluye dise帽o de pruebas, set de pruebas y tiempo de ejecuci贸n.</p>
            </div>


            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5 space-y-4 border border-gray-200 dark:border-gray-600">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100">Pruebas de Estr茅s y Carga</h3>
                    <label class="toggle-switch">
                        <input type="checkbox" id="stressToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <p class="text-sm footer-text">
                    Las horas se calculan autom谩ticamente con las siguientes variables:
                </p>
                
                <div>
                    <label for="stressScenarioComplexity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Complejidad del Escenario
                    </label>
                    <select id="stressScenarioComplexity" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                        <option value="2">Baja (2 horas)</option>
                        <option value="6" selected>Media (6 horas)</option>
                        <option value="12">Alta (12 horas)</option>
                    </select>
                </div>
                
                <div>
                    <label for="stressUserVolume" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Volumen de Usuarios Simulados
                    </label>
                    <select id="stressUserVolume" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                        <option value="4">Bajo (&lt; 500 usuarios)</option>
                        <option value="10" selected>Medio (500 - 1500 usuarios)</option>
                        <option value="20">Alto (> 1500 usuarios)</option>
                    </select>
                </div>
                
                <div>
                    <label for="stressEnvSetup" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Configuraci贸n del Entorno
                    </label>
                    <select id="stressEnvSetup" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                        <option value="3">Baja (3 horas)</option>
                        <option value="8" selected>Media (8 horas)</option>
                        <option value="15">Alta (15 horas)</option>
                    </select>
                </div>
                
                <div>
                    <label for="stressAnalysisTime" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        An谩lisis de Resultados
                    </label>
                    <select id="stressAnalysisTime" class="input-field w-full px-4 py-2 border rounded-xl focus:ring-2">
                        <option value="4">Bajo (4 horas)</option>
                        <option value="8" selected>Medio (8 horas)</option>
                        <option value="16">Alto (16 horas)</option>
                    </select>
                </div>
                
                <div class="mt-4 text-base font-bold text-gray-800 dark:text-gray-100">
                    Total de Pruebas de Estr茅s y Carga: <span id="stressTotal" class="text-blue-600 dark:text-blue-400">0 horas</span>
                </div>
            </div>
        </div>

        <div class="text-center result-box rounded-xl p-6 border mb-10">
            <h2 class="text-2xl font-bold">
                Estimaci贸n Final Ajustada
            </h2>
            <p class="text-5xl font-extrabold mt-3">
                <span id="finalEstimate">0</span> horas
            </p>
        </div>

        <div class="mt-10 space-y-6">
            <h2 class="text-2xl font-bold section-title text-center">Escenarios de Incertidumbre</h2>

            <div class="scenario-most-probable rounded-xl p-5 border">
                <h3 class="text-xl font-semibold mb-3">M谩s Probable (+35%)</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-base">
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Desarrollo:</span>
                        <span id="mostProbableDev" class="font-bold">0 horas</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Pruebas QA:</span>
                        <span id="mostProbableQA" class="font-bold">0 horas</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Pruebas de Estr茅s:</span>
                        <span id="mostProbableStress" class="font-bold">0 horas</span>
                    </div>
                </div>
                <div class="mt-4 text-lg font-bold">
                    Total: <span id="mostProbableTotal">0 horas</span>
                </div>
            </div>

            <div class="scenario-optimistic rounded-xl p-5 border">
                <h3 class="text-xl font-semibold mb-3">Optimista (+50%)</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-base">
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Desarrollo:</span>
                        <span id="optimisticDev" class="font-bold">0 horas</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Pruebas QA:</span>
                        <span id="optimisticQA" class="font-bold">0 horas</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Pruebas de Estr茅s:</span>
                        <span id="optimisticStress" class="font-bold">0 horas</span>
                    </div>
                </div>
                <div class="mt-4 text-lg font-bold">
                    Total: <span id="optimisticTotal">0 horas</span>
                </div>
            </div>
            
            <div class="scenario-pessimistic rounded-xl p-5 border">
                <h3 class="text-xl font-semibold mb-3">Pesimista (+65%)</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-base">
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Desarrollo:</span>
                        <span id="pessimisticDev" class="font-bold">0 horas</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Pruebas QA:</span>
                        <span id="pessimisticQA" class="font-bold">0 horas</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Pruebas de Estr茅s:</span>
                        <span id="pessimisticStress" class="font-bold">0 horas</span>
                    </div>
                </div>
                <div class="mt-4 text-lg font-bold">
                    Total: <span id="pessimisticTotal">0 horas</span>
                </div>
            </div>
        </div>

        <div class="mt-8 flex justify-center space-x-4">
            <button id="resetButton" class="px-6 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors no-print">
                Reiniciar Estimaci贸n
            </button>
            <button id="exportPdfButton" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors no-print">
                Exportar a PDF
            </button>
        </div>
        </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const FACTORS = {
                UNIT_TEST_BACK: 0.15,
                UNIT_TEST_FRONT: 0.15,
                STATIC_ANALYSIS: 0.10,
                PEER_REVIEW: 0.07,
                QA_CYCLE_1: 0.35,
                QA_CYCLE_2: 0.40,
                SCENARIO_PROBABLE: 1.35,
                SCENARIO_OPTIMISTIC: 1.50,
                SCENARIO_PESSIMISTIC: 1.65
            };

            const elements = {
                inputs: document.querySelectorAll('select, input[type="checkbox"]'),
                unitTestBackHours: document.getElementById('unitTestBackHours'),
                unitTestFrontHours: document.getElementById('unitTestFrontHours'),
                unitTestTotal: document.getElementById('unitTestTotal'),
                staticAnalysisHours: document.getElementById('staticAnalysisHours'),
                peerReviewHours: document.getElementById('peerReviewHours'),
                qaCycle1Hours: document.getElementById('qaCycle1Hours'),
                qaCycle2Hours: document.getElementById('qaCycle2Hours'),
                qaHoursTotal: document.getElementById('qaHoursTotal'),
                stressTotal: document.getElementById('stressTotal'),
                finalEstimate: document.getElementById('finalEstimate'),
                mExpDisplay: document.getElementById('mExpDisplay'),
                mTecDisplay: document.getElementById('mTecDisplay'),
                mAmbDisplay: document.getElementById('mAmbDisplay'),
                optimisticDev: document.getElementById('optimisticDev'),
                optimisticQA: document.getElementById('optimisticQA'),
                optimisticStress: document.getElementById('optimisticStress'),
                optimisticTotal: document.getElementById('optimisticTotal'),
                mostProbableDev: document.getElementById('mostProbableDev'),
                mostProbableQA: document.getElementById('mostProbableQA'),
                mostProbableStress: document.getElementById('mostProbableStress'),
                mostProbableTotal: document.getElementById('mostProbableTotal'),
                pessimisticDev: document.getElementById('pessimisticDev'),
                pessimisticQA: document.getElementById('pessimisticQA'),
                pessimisticStress: document.getElementById('pessimisticStress'),
                pessimisticTotal: document.getElementById('pessimisticTotal'),
                darkModeToggle: document.getElementById('darkModeToggle'),
                resetButton: document.getElementById('resetButton'),
                form: document.getElementById('estimatorForm')
            };

            function getInputs() {
                const isChecked = (id) => document.getElementById(id).checked;
                const getValue = (id) => parseFloat(document.getElementById(id).value) || 0;
                const m_experiencia = getValue('developerExperience');
                const m_conocimiento = getValue('techKnowledge');
                const m_ambiente = 1.0 + getValue('requirementsClarity') + getValue('pipelineMaturity') + getValue('teamCommunication');
                const logicComplexity = isChecked('logicComplexityToggle') ? getValue('logicComplexity') : 0;
                const frontendLogicComplexity = isChecked('frontendLogicComplexityToggle') ? getValue('frontendLogicComplexity') : 0;
                const uiComplexity = getValue('uiComplexity');
                const integrationComplexity = getValue('integrationComplexity');
                const dataComplexity = getValue('dataComplexity');
                const documentationComplexity = getValue('documentationComplexity');
                const deploymentTime = getValue('deploymentTime');
                const externalDependencies = getValue('externalDependencies');
                const domainKnowledge = getValue('domainKnowledge');
                let stressHours = 0;
                if (isChecked('stressToggle')) {
                    stressHours = getValue('stressScenarioComplexity') + getValue('stressUserVolume') +
                                  getValue('stressEnvSetup') + getValue('stressAnalysisTime');
                }
                return {
                    m_experiencia, m_conocimiento, m_ambiente,
                    logicComplexity, frontendLogicComplexity, uiComplexity, integrationComplexity, dataComplexity,
                    documentationComplexity, deploymentTime, externalDependencies, domainKnowledge,
                    stressHours,
                    isQaCycle2Enabled: isChecked('qaCycle2Toggle')
                };
            }
            
            function performCalculations(inputs) {
                const totalLogicHours = inputs.logicComplexity + inputs.frontendLogicComplexity;
                const unitTestBackHours = inputs.logicComplexity * FACTORS.UNIT_TEST_BACK;
                const unitTestFrontHours = inputs.frontendLogicComplexity * FACTORS.UNIT_TEST_FRONT;
                const unitTestTotal = unitTestBackHours + unitTestFrontHours;
                const staticAnalysisHours = totalLogicHours * FACTORS.STATIC_ANALYSIS;
                const peerReviewHours = totalLogicHours * FACTORS.PEER_REVIEW;
                const baseDevEffort = totalLogicHours + unitTestTotal + staticAnalysisHours + peerReviewHours +
                                      inputs.uiComplexity + inputs.integrationComplexity + inputs.dataComplexity +
                                      inputs.documentationComplexity + inputs.deploymentTime + inputs.externalDependencies +
                                      inputs.domainKnowledge;
                const adjustedDevEffort = baseDevEffort * inputs.m_experiencia * inputs.m_conocimiento * inputs.m_ambiente;
                const qaCycle1Hours = adjustedDevEffort * FACTORS.QA_CYCLE_1;
                const qaCycle2Hours = inputs.isQaCycle2Enabled ? qaCycle1Hours * FACTORS.QA_CYCLE_2 : 0;
                const qaTotalHours = qaCycle1Hours + qaCycle2Hours;
                const finalEstimate = adjustedDevEffort + qaTotalHours + inputs.stressHours;
                const mostProbableDev = adjustedDevEffort * FACTORS.SCENARIO_PROBABLE;
                const mostProbableQA = qaTotalHours * FACTORS.SCENARIO_PROBABLE;
                const mostProbableStress = inputs.stressHours * FACTORS.SCENARIO_PROBABLE;
                const optimisticDev = adjustedDevEffort * FACTORS.SCENARIO_OPTIMISTIC;
                const optimisticQA = qaTotalHours * FACTORS.SCENARIO_OPTIMISTIC;
                const optimisticStress = inputs.stressHours * FACTORS.SCENARIO_OPTIMISTIC;
                const pessimisticDev = adjustedDevEffort * FACTORS.SCENARIO_PESSIMISTIC;
                const pessimisticQA = qaTotalHours * FACTORS.SCENARIO_PESSIMISTIC;
                const pessimisticStress = inputs.stressHours * FACTORS.SCENARIO_PESSIMISTIC;
                return {
                    unitTestBackHours, unitTestFrontHours, unitTestTotal, staticAnalysisHours, peerReviewHours,
                    qaCycle1Hours, qaCycle2Hours, qaTotalHours, finalEstimate,
                    mostProbable: { dev: mostProbableDev, qa: mostProbableQA, stress: mostProbableStress, total: mostProbableDev + mostProbableQA + mostProbableStress },
                    optimistic: { dev: optimisticDev, qa: optimisticQA, stress: optimisticStress, total: optimisticDev + optimisticQA + optimisticStress },
                    pessimistic: { dev: pessimisticDev, qa: pessimisticQA, stress: pessimisticStress, total: pessimisticDev + pessimisticQA + pessimisticStress }
                };
            }

            function updateUI(results, inputs) {
                const updateText = (el, val, unit = ' horas', decimals = 2) => {
                    if (el) el.innerText = `${val.toFixed(decimals)}${unit}`;
                };
                const updateRoundedText = (el, val, unit = ' horas') => {
                    if(el) el.innerText = `${Math.round(val)}${unit}`;
                }
                elements.mExpDisplay.innerText = `${inputs.m_experiencia.toFixed(1)}x`;
                elements.mTecDisplay.innerText = `${inputs.m_conocimiento.toFixed(1)}x`;
                elements.mAmbDisplay.innerText = `${inputs.m_ambiente.toFixed(2)}x`;
                updateText(elements.unitTestBackHours, results.unitTestBackHours);
                updateText(elements.unitTestFrontHours, results.unitTestFrontHours);
                updateText(elements.unitTestTotal, results.unitTestTotal);
                updateText(elements.staticAnalysisHours, results.staticAnalysisHours);
                updateText(elements.peerReviewHours, results.peerReviewHours);
                updateText(elements.qaCycle1Hours, results.qaCycle1Hours);
                updateText(elements.qaCycle2Hours, results.qaCycle2Hours);
                updateText(elements.qaHoursTotal, results.qaTotalHours);
                updateText(elements.stressTotal, inputs.stressHours);

                // ===== INICIO DE LA CORRECCIN =====
                // Se actualiza solo el n煤mero, ya que "horas" est谩 en el HTML.
                elements.finalEstimate.innerText = Math.round(results.finalEstimate);
                // ===== FIN DE LA CORRECCIN =====

                updateText(elements.mostProbableDev, results.mostProbable.dev);
                updateText(elements.mostProbableQA, results.mostProbable.qa);
                updateText(elements.mostProbableStress, results.mostProbable.stress);
                updateRoundedText(elements.mostProbableTotal, results.mostProbable.total, ' horas');
                updateText(elements.optimisticDev, results.optimistic.dev);
                updateText(elements.optimisticQA, results.optimistic.qa);
                updateText(elements.optimisticStress, results.optimistic.stress);
                updateRoundedText(elements.optimisticTotal, results.optimistic.total, ' horas');
                updateText(elements.pessimisticDev, results.pessimistic.dev);
                updateText(elements.pessimisticQA, results.pessimistic.qa);
                updateText(elements.pessimisticStress, results.pessimistic.stress);
                updateRoundedText(elements.pessimisticTotal, results.pessimistic.total, ' horas');
            }
            
            function main() {
                const inputs = getInputs();
                const results = performCalculations(inputs);
                updateUI(results, inputs);
            }

            // --- MANEJADORES DE EVENTOS ---
            elements.inputs.forEach(input => input.addEventListener('change', main));
            
            elements.resetButton.addEventListener('click', () => {
                elements.form.querySelectorAll('select').forEach(select => {
                    let lowestValue = Infinity;
                    let valueToSet = '';
                    select.querySelectorAll('option').forEach(option => {
                        const numericValue = parseFloat(option.value);
                        if (numericValue < lowestValue) {
                            lowestValue = numericValue;
                            valueToSet = option.value;
                        }
                    });
                    select.value = valueToSet;
                });
                elements.form.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                main();
            });

            const exportPdfButton = document.getElementById('exportPdfButton');
            exportPdfButton.addEventListener('click', () => {
                window.print();
            });

            elements.darkModeToggle.addEventListener('change', () => {
                document.documentElement.classList.toggle('dark');
            });

            // --- INICIALIZACIN ---
            main();
        });
    </script>
</body>
</html>